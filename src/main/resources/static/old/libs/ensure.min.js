(function(){window.ensure=function(a,b,g){if("undefined"==typeof jQuery&&"undefined"==typeof Sys&&"undefined"==typeof Prototype)return alert("jQuery, Microsoft ASP.NET AJAX or Prototype library not found. One must be present for ensure to work");if("undefined"!=typeof a.test){var d=function(){return a.test};"string"==typeof a.test?d=function(){return!("undefined"==eval("typeof "+a.test)&&null==document.getElementById(a.test))}:"function"==typeof a.test&&(d=a.test);!1===d()||"undefined"==typeof d()||
null==d()?new ensureExecutor(a,b,g):b()}else new ensureExecutor(a,b,g)};window.ensureExecutor=function(a,b,g){this.data=this.clone(a);this.callback="undefined"==typeof g||null==g?b:this.delegate(b,g);this.loadStack=[];a.js&&a.js.constructor!=Array&&(this.data.js=[a.js]);a.html&&a.html.constructor!=Array&&(this.data.html=[a.html]);a.css&&a.css.constructor!=Array&&(this.data.css=[a.css]);"undefined"==typeof a.js&&(this.data.js=[]);"undefined"==typeof a.html&&(this.data.html=[]);"undefined"==typeof a.css&&
(this.data.css=[]);this.init();this.load()};window.ensureExecutor.prototype={init:function(){if("undefined"!=typeof jQuery)this.getJS=c.loadJavascript_jQuery,this.httpGet=c.httpGet_jQuery;else if("undefined"!=typeof Prototype)this.getJS=c.loadJavascript_Prototype,this.httpGet=c.httpGet_Prototype;else if("undefined"!=typeof Sys)this.getJS=c.loadJavascript_MSAJAX,this.httpGet=c.httpGet_MSAJAX;else throw"jQuery, Prototype or MS AJAX framework not found";},getJS:function(a){},httpGet:function(a,b){},
load:function(){this.loadJavascripts(this.delegate(function(){this.loadCSS(this.delegate(function(){this.loadHtml(this.delegate(function(){this.callback()}))}))}))},loadJavascripts:function(a){var b=this.data.js.length;if(0===b)return a();this.forEach(this.data.js,function(a){c.isUrlLoaded(a)||this.isTagLoaded("script","src",a)?b--:this.getJS({url:a,success:this.delegate(function(d){b--;c.registerUrl(a)}),error:this.delegate(function(d){b--;"function"==typeof this.data.error&&this.data.error(a,d)})})});
this.until({test:function(){return 0===b},delay:50,callback:this.delegate(function(){a()})})},loadCSS:function(a){if(0===this.data.css.length)return a();var b=c.getHead();this.forEach(this.data.css,function(a){if(!c.isUrlLoaded(a)&&!this.isTagLoaded("link","href",a))try{(function(a,b){var d=document.createElement("link");d.setAttribute("href",a);d.setAttribute("rel","Stylesheet");d.setAttribute("type","text/css");b.appendChild(d);c.registerUrl(a)}).apply(window,[a,b])}catch(d){"function"==typeof this.data.error&&
this.data.error(a,d.message)}});a()},loadHtml:function(a){var b=this.data.html.length;if(0===b)return a();this.forEach(this.data.html,function(a){c.isUrlLoaded(a)?b--:this.httpGet({url:a,success:this.delegate(function(d){b--;c.registerUrl(a);var f=this.data.parent||document.body.appendChild(document.createElement("div"));"string"==typeof f&&(f=document.getElementById(f));f.innerHTML=d}),error:this.delegate(function(d){b--;"function"==typeof this.data.error&&this.data.error(a,d)})})});this.until({test:function(){return 0===
b},delay:50,callback:this.delegate(function(){a()})})},clone:function(a){var b={},c;for(c in a){var d=a[c];if("object"==typeof d)if(d.constructor==Array){for(var f=[],e=0;e<d.length;e++)f.push(d[e]);b[c]=f}else b[c]=this.clone(d);else b[c]=d}return b},forEach:function(a,b){for(var c=0;c<a.length;c++)b.apply(this,[a[c]])},delegate:function(a,b){var c=b||this;return function(){a.apply(c,arguments)}},until:function(a){!0===a.test()?a.callback():window.setTimeout(this.delegate(function(){this.until(a)}),
a.delay||50)},isTagLoaded:function(a,b,c){var d=document.createElement(a);d[b]=c;var f=!1;a=document.getElementsByTagName(a);this.forEach(a,function(a){if(d[b]===a[b])return f=!0,!1});return f}};var e=navigator.userAgent.toLowerCase(),c={browser:{version:(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(e),opera:/opera/.test(e),msie:/msie/.test(e)&&!/opera/.test(e),mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)},loadedUrls:{},isUrlLoaded:function(a){return!0===c.loadedUrls[a]},
unregisterUrl:function(a){c.loadedUrls[a]=!1},registerUrl:function(a){c.loadedUrls[a]=!0},createScriptTag:function(a,b,g){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("src",a);d.onload=d.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||b()};d.onerror=function(){g(data.url+" failed to load")};c.getHead().appendChild(d)},getHead:function(){return document.getElementsByTagName("head")[0]||document.documentElement},
globalEval:function(a){var b=document.createElement("script");b.type="text/javascript";c.browser.msie?b.text=a:b.appendChild(document.createTextNode(a));c.getHead().appendChild(b)},loadJavascript_jQuery:function(a){if(c.browser.safari)return jQuery.ajax({type:"GET",url:a.url,data:null,success:function(b){c.globalEval(b);a.success()},error:function(b,c,d){b&&b.responseText?a.error(b.responseText):a.error(url+"\n"+d.message)},dataType:"html"});c.createScriptTag(a.url,a.success,a.error)},loadJavascript_MSAJAX:function(a){c.browser.safari?
c.httpGet_MSAJAX({url:a.url,success:function(b){c.globalEval(b);a.success(b)},error:a.error}):c.createScriptTag(a.url,a.success,a.error)},loadJavascript_Prototype:function(a){c.browser.safari?c.httpGet_Prototype({url:a.url,success:function(b){c.globalEval(b);a.success(b)},error:a.error}):c.createScriptTag(a.url,a.success,a.error)},httpGet_jQuery:function(a){return jQuery.ajax({type:"GET",url:a.url,data:null,success:a.success,error:function(b,c,d){b&&b.responseText?a.error(b.responseText):a.error("Error occured while loading: "+
url+"\n"+d.message)},dataType:a.type||"html"})},httpGet_MSAJAX:function(a){var b=new Sys.Net.WebRequest;b.set_url(a.url);b.set_httpVerb("GET");b.add_completed(function(b){var c="Failed to load:"+a.url;b.get_timedOut()&&(c="Timed out");b.get_aborted()&&(c="Aborted");b.get_responseAvailable()?a.success(b.get_responseData()):a.error(c)});var c=new Sys.Net.XMLHttpExecutor;b.set_executor(c);c.executeRequest()},httpGet_Prototype:function(a){new Ajax.Request(a.url,{method:"get",evalJS:!1,onSuccess:function(b,
c){a.success(b.responseText||"")},onFailure:a.error})}}})();