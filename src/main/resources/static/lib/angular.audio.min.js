"use strict";angular.module("ngAudio",[]).directive("ngAudio",["$compile","$q","ngAudio",function(a,b,c){return{restrict:"AEC",scope:{volume:"=",start:"=",currentTime:"=",loop:"=",clickPlay:"=",disablePreload:"="},controller:function(a,b,d,e){function g(){f=c.load(b.ngAudio),a.$audio=f,f.unbind()}var f;a.disablePreload||g(),d.on("click",function(){a.clickPlay!==!1&&(a.disablePreload&&g(),f.audio.play(),f.volume=a.volume||f.volume,f.loop=a.loop,f.currentTime=a.start||0,e(function(){f.play()},5))})}}}]).directive("ngAudioHover",["$compile","$q","ngAudio",function(a,b,c){return{restrict:"AEC",controller:function(a,b,d,e){var f=c.load(b.ngAudioHover);d.on("mouseover rollover hover",function(){f.audio.play(),f.volume=b.volumeHover||f.volume,f.loop=b.loop,f.currentTime=b.startHover||0})}}}]).service("localAudioFindingService",["$q",function(a){this.find=function(b){var c=a.defer(),d=document.getElementById(b);return d?c.resolve(d):c.reject(b),c.promise}}]).service("remoteAudioFindingService",["$q",function(a){this.find=function(b){var c=a.defer(),d=new Audio;return d.addEventListener("error",function(){c.reject()}),d.addEventListener("loadstart",function(){c.resolve(d)}),setTimeout(function(){d.src=b},1),c.promise}}]).service("cleverAudioFindingService",["$q","localAudioFindingService","remoteAudioFindingService",function(a,b,c){this.find=function(d){var e=a.defer();return d=d.replace("|","/"),b.find(d).then(e.resolve,function(){return c.find(d)}).then(e.resolve,e.reject),e.promise}}]).value("ngAudioGlobals",{muting:!1,songmuting:!1,performance:25,unlock:!0}).factory("NgAudioObject",["cleverAudioFindingService","$rootScope","$interval","$timeout","ngAudioGlobals",function(a,b,c,d,e){return function(d){function s(){f=b.$watch(function(){return{volume:q.volume,currentTime:q.currentTime,progress:q.progress,muting:q.muting,loop:q.loop,playbackRate:q.playbackRate}},function(a,b){a.currentTime!==b.currentTime&&q.setCurrentTime(a.currentTime),a.progress!==b.progress&&q.setProgress(a.progress),a.volume!==b.volume&&q.setVolume(a.volume),a.playbackRate!==b.playbackRate&&q.setPlaybackRate(a.playbackRate),m=a.loop,a.muting!==b.muting&&q.setMuting(a.muting)},!0)}function u(){f&&f(),p&&(n||e.isMuting?p.volume=0:p.volume=void 0!==q.volume?q.volume:1,g&&(p.play(),g=!1),i&&(p.pause(),p.currentTime=0,i=!1),h&&(p.pause(),h=!1),j&&(p.playbackRate=k,j=!1),l&&(p.volume=l,l=void 0),o&&(q.currentTime=p.currentTime,q.duration=p.duration,q.remaining=p.duration-p.currentTime,q.progress=p.currentTime/p.duration,q.paused=p.paused,q.src=p.src,q.currentTime>=q.duration&&r.forEach(function(a){a(q)}),m&&q.currentTime>=q.duration&&(m!==!0&&(m--,q.loop--),q.setCurrentTime(0),q.play())),n||e.isMuting||(q.volume=p.volume),q.audio=p),s()}e.unlock&&window.addEventListener("click",function a(){p&&(p.play(),p.pause()),window.removeEventListener("click",a)});var f,l,m,p,g=!1,h=!1,i=!1,j=!1,k=!1,n=!1,o=!0,q=this;this.id=d,this.safeId=d.replace("/","|"),this.loop=0,this.unbind=function(){o=!1},this.play=function(){return g=!0,this};var r=[];this.complete=function(a){r.push(a)},this.pause=function(){h=!0},this.restart=function(){i=!0},this.stop=function(){this.restart()},this.setVolume=function(a){l=a},this.setPlaybackRate=function(a){k=a,j=!0},this.setMuting=function(a){n=a},this.setProgress=function(a){p&&p.duration&&isFinite(a)&&(p.currentTime=p.duration*a)},this.setCurrentTime=function(a){p&&p.duration&&(p.currentTime=a)},a.find(d).then(function(a){p=a,p.addEventListener("canplay",function(){q.canPlay=!0})},function(a){q.error=!0,console.warn(a)});var t=c(u,e.performance);b.$watch(function(){return e.performance},function(){c.cancel(t),t=c(u,e.performance)})}}]).service("ngAudio",["NgAudioObject","ngAudioGlobals",function(a,b){this.play=function(b){var c=new a(b);return c.play(),c},this.load=function(b){return new a(b)},this.mute=function(){b.muting=!0},this.unmute=function(){b.muting=!1},this.toggleMute=function(){b.muting=!b.muting},this.setUnlock=function(a){b.unlock=a}}]).filter("trackTime",function(){return function(a){for(var b=0,c=a?a.toString():"",d=0;d<c.length;d++){var e=c.indexOf(".");b=parseInt(c.slice(0,e))}var f="",g=0,h=0,i=0;return b>3599?(g=Math.floor(b/3600),h=Math.floor((b-3600*g)/60),i=b-(60*h+3600*g),1==g.toString().length&&(g="0"+Math.floor(b/3600).toString()),1==h.toString().length&&(h="0"+Math.floor((b-3600*g)/60).toString()),1==i.toString().length&&(i="0"+(b-(60*h+3600*g)).toString()),f=g+":"+h+":"+i):b>59?(h=Math.floor(b/60),i=b-60*h,1==h.toString().length&&(h="0"+Math.floor(b/60).toString()),1==i.toString().length&&(i="0"+(b-60*h).toString()),f=h+":"+i):(i=b,1==i.toString().length&&(i="0"+b.toString()),f=b+"s"),f}});